import{e as yt,f as A,g as vt,h as Ct}from"./chunk-BYSPJEKG.js";import{a as xt,b as Dt}from"./chunk-7CLO37HK.js";import{A as B,Ca as tt,Fa as et,Ga as M,Ha as y,Hc as pt,Ic as ut,Ja as m,La as it,Lb as ct,Mb as v,Mc as mt,Nb as C,Q,Ra as x,Re as gt,Sa as nt,Se as ft,Te as _t,Ua as ot,Va as at,W as Z,Wa as h,X as R,Xa as p,Ya as _,Za as N,_ as f,_a as j,_b as dt,aa as l,ab as P,ba as k,ca as q,da as U,db as z,dc as ht,fb as g,h as $,ha as J,ia as I,ja as F,kb as E,lb as L,ma as K,mb as O,n as G,pa as X,pb as W,qa as S,qb as rt,rb as st,ua as w,xb as H,ya as s,za as Y,zb as lt}from"./chunk-ZYDLUYJD.js";var zt=["container"],Et=(()=>{let i=class i{get cog(){return this._cog}set cog(t){this._cog=this.cogSrv.merge("chart",{theme:"",libs:["https://gw.alipayobjects.com/os/lib/antv/g2/4.1.46/dist/g2.min.js","https://gw.alipayobjects.com/os/lib/antv/data-set/0.11.8/dist/data-set.js"]},t)}constructor(){this.cogSrv=f(ut),this.lazySrv=f(pt),this.loading=!1,this.loaded=!1,this.notify$=new $,this.cog={theme:""}}libLoad(){return this.loading?(this.loaded&&this.notify$.next(),this):(this.loading=!0,this.lazySrv.load(this.cog.libs).then(()=>{this.loaded=!0,this.notify$.next()}),this)}get notify(){return this.notify$.asObservable()}ngOnDestroy(){this.notify$.unsubscribe()}};i.\u0275fac=function(n){return new(n||i)},i.\u0275prov=Z({token:i,factory:i.\u0275fac,providedIn:"root"});let e=i;return e})(),Tt=(()=>{let i=class i{get chart(){return this._chart}get winG2(){return window.G2}constructor(){this.srv=f(Et),this.el=f(X),this.ngZone=f(tt),this.platform=f(mt),this.cdr=f(ct),this.repaint=!0,this.destroy$=new $,this.loaded=!1,this.delay=0,this.ready=new S,this.theme=this.srv.cog.theme,this.srv.notify.pipe(Q(this.destroy$),B(()=>!this.loaded)).subscribe(()=>this.load())}changeData(){}onInit(){}onChanges(t){}load(){this.ngZone.run(()=>{this.loaded=!0,this.cdr.detectChanges()}),setTimeout(()=>this.install(),this.delay)}ngOnInit(){this.platform.isBrowser&&(this.onInit(),this.winG2?this.load():this.srv.libLoad())}ngOnChanges(t){if(this.onChanges(t),this.onlyChangeData?this.onlyChangeData(t):Object.keys(t).length===1&&!!t.data){this.changeData();return}!this.chart||!this.repaint||this.ngZone.runOutsideAngular(()=>{this.destroyChart().install()})}destroyChart(){return this._chart&&this._chart.destroy(),this}ngOnDestroy(){this.resize$&&this.resize$.unsubscribe(),this.destroy$.next(),this.destroy$.complete(),this.destroyChart()}};i.\u0275fac=function(n){return new(n||i)},i.\u0275dir=U({type:i,viewQuery:function(n,o){if(n&1&&E(zt,7),n&2){let r;L(r=O())&&(o.node=r.first)}},inputs:{repaint:[l.HasDecoratorInputTransform,"repaint","repaint",v],delay:[l.HasDecoratorInputTransform,"delay","delay",C],theme:"theme"},outputs:{ready:"ready"},features:[M,J]});let e=i;return G([A()],e.prototype,"load",null),G([A()],e.prototype,"destroyChart",null),e})();var Lt=e=>({"background-color":e});function Ot(e,i){e&1&&_(0,"nz-skeleton")}function Ht(e,i){if(e&1&&(N(0),_(1,"div",7),j()),e&2){let a=g(3);s(),m("innerHTML",a.subTitle,w)}}function $t(e,i){if(e&1&&(h(0,"h4",4),y(1,Ht,2,1,"ng-container",6),p()),e&2){let a=g(2);s(),m("nzStringTemplateOutlet",a.subTitle)}}function Gt(e,i){if(e&1&&(N(0),_(1,"div",7),j()),e&2){let a=g(3);s(),m("innerHTML",a.total,w)}}function Nt(e,i){if(e&1&&(h(0,"div",5),y(1,Gt,2,1,"ng-container",6),p()),e&2){let a=g(2);s(),m("nzStringTemplateOutlet",a.total)}}function jt(e,i){if(e&1&&(h(0,"div",2),y(1,$t,2,1,"h4",4)(2,Nt,2,1,"div",5),p()),e&2){let a=g();s(),x(1,a.subTitle?1:-1),s(),x(2,a.total?2:-1)}}function Wt(e,i){if(e&1){let a=P();h(0,"li",9),z("click",function(){let n=I(a).$index,o=g(2);return F(o._click(n))}),_(1,"span",10),h(2,"span",11),W(3),p(),_(4,"nz-divider",12),h(5,"span",13),W(6),p(),_(7,"span",14),p()}if(e&2){let a=i.$implicit,t=g(2);s(),m("ngStyle",lt(4,Lt,a.checked?a.color:"#aaa")),s(2),rt(a.x),s(3),st("",a.percent,"%"),s(),m("innerHTML",t.valueFormat?t.valueFormat(a.y):a.y,w)}}function At(e,i){if(e&1&&(h(0,"ul",3),ot(1,Wt,8,6,"li",8,nt),p()),e&2){let a=g();s(),at(a.legendData)}}var V=(()=>{let i=class i extends Tt{constructor(){super(...arguments),this.legendData=[],this.isPercent=!1,this.animate=!0,this.color="rgba(24, 144, 255, 0.85)",this.height=0,this.hasLegend=!1,this.inner=.75,this.padding=[12,0,12,0],this.tooltip=!0,this.lineWidth=0,this.blockMaxWidth=380,this.select=!0,this.data=[],this.interaction="none",this.ratio={text:"\u5360\u6BD4",inverse:"\u53CD\u6BD4",color:"",inverseColor:"#F0F2F5"},this.clickItem=new S,this.block=!1}fixData(){let{percent:t,color:n}=this;if(this.isPercent=t!=null,!this.isPercent)return;this.select=!1,this.tooltip=!1;let{text:o,inverse:r,color:u,inverseColor:c}=this.ratio;this.percentColor=b=>b===o?u||n:c,this.data=[{x:o,y:t},{x:r,y:100-t}]}updateBlock(){this.block=this._chart&&this.hasLegend&&this.el.nativeElement.clientWidth<=this.blockMaxWidth,this.cdr.detectChanges()}install(){let{node:t,height:n,padding:o,tooltip:r,inner:u,hasLegend:c,interaction:b,theme:It,animate:Ft,lineWidth:St,isPercent:wt,percentColor:Mt,colors:Pt}=this,d=this._chart=new this.winG2.Chart({container:t.nativeElement,autoFit:!0,height:n,padding:o,theme:It});d.animate(Ft),r?d.tooltip({showTitle:!1,showMarkers:!1}):d.tooltip(!1),b!=="none"&&d.interaction(b),d.axis(!1).legend(!1).coordinate("theta",{innerRadius:u}),d.filter("x",(D,T)=>T.checked!==!1),d.interval().adjust("stack").position("y").style({lineWidth:St,stroke:"#fff"}).color("x",wt?Mt:Pt).tooltip("x*percent",(D,T)=>({name:D,value:`${c?T:(T*100).toFixed(2)} %`})).state({}),d.scale({x:{type:"cat",range:[0,1]}}),d.on("interval:click",D=>{this.ngZone.run(()=>this.clickItem.emit({item:D.data?.data,ev:D}))}).on("afterrender",()=>{this.ngZone.run(()=>this.updateBlock())}),this.ready.next(d),this.changeData(),d.render()}changeData(){let{_chart:t,data:n}=this;if(!t||!Array.isArray(n)||n.length<=0)return;let o=n.reduce((r,u)=>r+u.y,0);for(let r of n)r.percent=o===0?0:r.y/o;t.changeData(n),this.ngZone.run(()=>this.genLegend())}genLegend(){let{hasLegend:t,isPercent:n,cdr:o,_chart:r}=this;!t||n||(this.legendData=r.geometries[0].dataArray.map(u=>{let c=u[0]._origin;return c.color=u[0].color,c.checked=!0,c.percent=(c.percent*100).toFixed(2),c}),o.detectChanges())}_click(t){let{legendData:n,_chart:o}=this;n[t].checked=!n[t].checked,o.render(!0)}onChanges(){this.fixData()}};i.\u0275fac=(()=>{let t;return function(o){return(t||(t=K(i)))(o||i)}})(),i.\u0275cmp=k({type:i,selectors:[["g2-pie"]],hostVars:8,hostBindings:function(n,o){n&2&&it("g2-pie",!0)("g2-pie__legend-has",o.hasLegend)("g2-pie__legend-block",o.block)("g2-pie__mini",o.isPercent)},inputs:{animate:[l.HasDecoratorInputTransform,"animate","animate",v],color:"color",subTitle:"subTitle",total:"total",height:[l.HasDecoratorInputTransform,"height","height",C],hasLegend:[l.HasDecoratorInputTransform,"hasLegend","hasLegend",v],inner:"inner",padding:"padding",percent:[l.HasDecoratorInputTransform,"percent","percent",C],tooltip:[l.HasDecoratorInputTransform,"tooltip","tooltip",v],lineWidth:[l.HasDecoratorInputTransform,"lineWidth","lineWidth",C],blockMaxWidth:[l.HasDecoratorInputTransform,"blockMaxWidth","blockMaxWidth",C],select:[l.HasDecoratorInputTransform,"select","select",v],valueFormat:"valueFormat",data:"data",colors:"colors",interaction:"interaction",ratio:"ratio"},outputs:{clickItem:"clickItem"},exportAs:["g2Pie"],standalone:!0,features:[M,et,H],decls:6,vars:3,consts:[["container",""],[1,"g2-pie__chart"],[1,"g2-pie__total"],[1,"g2-pie__legend"],[1,"g2-pie__total-title"],[1,"g2-pie__total-stat"],[4,"nzStringTemplateOutlet"],[3,"innerHTML"],[1,"g2-pie__legend-item"],[1,"g2-pie__legend-item",3,"click"],[1,"g2-pie__legend-dot",3,"ngStyle"],[1,"g2-pie__legend-title"],["nzType","vertical"],[1,"g2-pie__legend-percent"],[1,"g2-pie__legend-value",3,"innerHTML"]],template:function(n,o){n&1&&(y(0,Ot,1,0,"nz-skeleton"),h(1,"div",1),_(2,"div",null,0),y(4,jt,3,2,"div",2),p(),y(5,At,3,0,"ul",3)),n&2&&(x(0,o.loaded?-1:0),s(4),x(4,o.subTitle||o.total?4:-1),s(),x(5,o.hasLegend&&o.legendData.length>0?5:-1))},dependencies:[xt,ft,vt,dt],encapsulation:2,changeDetection:0});let e=i;return e})(),Vt=[V],kt=(()=>{let i=class i{};i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=q({type:i}),i.\u0275inj=R({imports:[ht,Ct,_t,Dt,Vt]});let e=i;return e})();var Qt=["pie"],De=(()=>{let i=class i{constructor(t){this.msg=t,this.height=190,this.salesPieData=[],this.total="",this.refresh()}refresh(){let t=(n=0,o=5e3)=>Math.floor(Math.random()*(o-n+1)+n);this.salesPieData=[{x:"Electricy",y:t()},{x:"Solar",y:t()},{x:"Gas",y:t()},{x:"Fuel",y:t()}],this.total=` ${this.salesPieData.reduce((n,o)=>o.y+n,0).toFixed(0)}`,this.pie&&setTimeout(()=>this.pie.changeData())}format(t){return`${t.toFixed(0)}`}handleClick(t){this.msg.info(`${t.item.x} - ${t.item.y}`)}};i.\u0275fac=function(n){return new(n||i)(Y(yt))},i.\u0275cmp=k({type:i,selectors:[["app-chart-pie"]],viewQuery:function(n,o){if(n&1&&E(Qt,5),n&2){let r;L(r=O())&&(o.pie=r.first)}},inputs:{height:"height"},standalone:!0,features:[H],decls:2,vars:5,consts:[["pie",""],["title","Energy Sources","subTitle","Energy Sources","repaint","false",3,"clickItem","hasLegend","total","valueFormat","data","height"]],template:function(n,o){if(n&1){let r=P();h(0,"g2-pie",1,0),z("clickItem",function(c){return I(r),F(o.handleClick(c))}),p()}n&2&&m("hasLegend",!0)("total",o.total)("valueFormat",o.format)("data",o.salesPieData)("height",o.height)},dependencies:[gt,kt,V],encapsulation:2});let e=i;return e})();export{De as a};
